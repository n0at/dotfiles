#!/bin/bash

if git_status=$(cd $1 && git status 2>/dev/null ); then
  git_branch="$(echo $git_status| awk 'NR==1 {print $3}')"
  first_color="colour84"
  second_color="#363a43"
  commits=""
  committed=""
  untracked=""
  staged=""
  if [[ ! -z "$(echo $git_status | grep 'Changes to be committed')" ]]; then
    first_color="colour228"
    committed="~"
  fi
  if [[ ! -z "$(echo $git_status | grep 'Changes not staged')" ]]; then
    first_color="colour203"
    staged="*"
  fi
  if [[ ! -z "$(echo $git_status | grep 'Untracked files')" ]]; then
    untracked="…"
  fi
  if [[ ! -z "$(echo $git_status | grep 'Your branch is ahead')" ]]; then
    commits="+"
  fi

  state="${staged}${committed}${untracked}${commits}"

  if [[ "$state" == "" ]]; then
    state="✔"
  fi

  git_info="#[bg=${first_color},fg=${second_color}]  "
  if [[ $git_branch != "master" ]]; then
    git_info="${git_info}${git_branch}"
  fi
  git_info="${git_info}${state} #[bg=#262a33,fg=${first_color}]#[default] "
else
  git_info="#[bg=#262a33,fg=#363a43]#[default] "
fi

directory="$1 #[default]"
echo " #[fg=colour32,bg=#262a33]#[fg=colour255,bg=colour32] #P  #{pane_pid} #[fg=colour32,bg=#363a43]#[fg=colour255,bg=#363a43] #(whoami)  $directory$git_info"
